<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Admin</title>

  <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-messaging.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-functions.js"></script>


  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- jQuery 3 -->
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
  <!-- ChartJS -->
  <script src="bower_components/chart.js/Chart.js"></script>
  <!-- Sparkline -->
  <script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
  <!-- Select2 -->
  <link rel="stylesheet" href="bower_components/select2/dist/css/select2.min.css">
  <!-- daterange picker -->
  <link rel="stylesheet" href="bower_components/bootstrap-daterangepicker/daterangepicker.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <link rel="stylesheet" href="dist/css/stylesAdmin.css">
  <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
        page. However, you can choose any other skin. Make sure you
        apply the skin class to the body tag so the changes take effect. -->
  <link rel="stylesheet" href="dist/css/skins/skin-blue.min.css">
  <!-- bootstrap wysihtml5 - text editor -->
  <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase.js"></script>

  <!-- Google Font -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <!-- Main Header -->
  <header class="main-header">

    <!-- Logo -->
    <a href="index2.html" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini"><b>A</b>LM</span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><b>Admin</b>BODYTECH</span>
    </a>

    <!-- Header Navbar -->
    <nav class="navbar navbar-static-top" role="navigation">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a>


    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">

    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">

      <!-- Sidebar user panel (optional) -->
      <div class="user-panel">
        <div class="pull-left image">
          <img src="dist/img/avatar.png" class="img-circle" alt="User Image">
        </div>
        <div class="pull-left info">
          <p>SuperAdmin</p>
          <!-- Status -->
          <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
        </div>
      </div>


      <!-- Sidebar Menu -->
      <ul class="sidebar-menu" data-widget="tree">
        <li class="header">SECCIONES</li>
        <!-- Optionally, you can add icons to the links -->
        <li class="active"><a href="#"><i class="fa fa-link"></i> <span>Index</span></a></li>
        <li><a href="paises.html"><i class="fa fa-link"></i> <span>Países</span></a></li>
        <li><a href="regiones.html"><i class="fa fa-link"></i> <span>Regiones</span></a></li>
        <li><a href="ciudades.html"><i class="fa fa-link"></i> <span>Ciudades</span></a></li>
        <li><a href="sedes.html"><i class="fa fa-link"></i> <span>Sedes</span></a></li>
        <li><a href="salones.html"><i class="fa fa-link"></i> <span>Salones</span></a></li>
        <li><a href="clases.html"><i class="fa fa-link"></i> <span>Clases</span></a></li>
        <li><a href="profesores.html"><i class="fa fa-link"></i> <span>Profesores</span></a></li>
      </ul>
      <!-- /.sidebar-menu -->
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">


    </section>

    <!-- Main content -->
    <section class="content container-fluid">

      <div class="row">
        <div class="form-group col-md-2">
            <label>País</label>
            <select class="form-control" id="item_pais">

            </select>
        </div>

        <div class="form-group col-md-2">
            <label>Región</label>
            <select class="form-control" id="item_region">

            </select>
        </div>

        <div class="form-group col-md-2">
            <label>Ciudad</label>
            <select class="form-control" id="item_ciudad">

            </select>
        </div>

        <div class="form-group col-md-2">
            <label>Sede</label>
            <select class="form-control" id="item_sede">

            </select>
        </div>

        <div class="form-group col-md-2">
            <label>Salón</label>
            <select class="form-control" id="item_salon">

            </select>
        </div>

        <div class="form-group col-md-2">
            <label>Clase</label>
            <select class="form-control" id="item_clase">

            </select>
        </div>
      </div>


      <div class="row">
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-aqua">
            <div class="inner">
              <h3 id="clases_creadas">0</h3>

              <p>CLASES TOTALES CREADAS</p>
            </div>
            <div class="icon">
              <i class="ion ion-bag"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
          </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-green">
            <div class="inner">
              <h3>53<sup style="font-size: 20px">%</sup></h3>

              <p>TASA DE OCUPACIÓN</p>
            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
          </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-yellow">
            <div class="inner">
              <h3 id="num_profesores">0</h3>

              <p>PROFESORES TOTALES</p>
            </div>
            <div class="icon">
              <i class="ion ion-person-add"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
          </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-red">
            <div class="inner">
              <h3>65</h3>

              <p>TOTAL ASISTENCIAS MES</p>
            </div>
            <div class="icon">
              <i class="ion ion-pie-graph"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
          </div>
        </div>
        <!-- ./col -->
      </div>


      <!-- TABLE: LATEST ORDERS -->
      <div class="box box-info">
        <div class="box-header with-border">
          <h3 class="box-title">Clases por asistencias</h3>

          <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
            </button>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
          </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
          <div class="table-responsive">
            <table class="table no-margin">
              <thead>
              <tr>
                <th>País</th>
                <th>Región</th>
                <th>Ciudad</th>
                <th>Sede</th>
                <th>Salón</th>
                <th>Clase</th>
                <th style="width: 300px">Asistencia</th>
              </tr>
              </thead>
              <tbody id="bodyTable">

              </tbody>
            </table>
          </div>
          <!-- /.table-responsive -->
        </div>
        <!-- /.box-body -->

      </div>
      <!-- /.box -->


      <div class="box">
        <div class="box-header with-border">
          <h3 class="box-title">Asistencia de clases por día</h3>

          <div class="box-body">
            <div class="row">
              <div class="col-md-5">
                <div class="form-group">
                  <label>Rango de fechas:</label>

                  <div class="input-group">
                    <div class="input-group-addon">
                      <i class="fa fa-calendar"></i>
                    </div>
                    <input type="text" class="form-control pull-right" id="datePicker" value="">
                  </div>
                  <!-- /.input group -->
                </div>
              </div>

              <div class="col-md-12">

                <p class="text-center">

                </p>

                <div class="chart">
                  <!-- Sales Chart Canvas -->
                  <canvas id="salesChart" style="height: 180px;"></canvas>
                </div>
                <!-- /.chart-responsive -->
              </div>
              <!-- /.col -->

              <!-- /.col -->
            </div>
            <!-- /.row -->
          </div>

        </div>
      </div>
    </div>


    </section>
    <!-- /.content -->


  </div>
  <!-- /.content-wrapper -->


</div>
<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->

<!-- jQuery 3 -->
<script src="bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- FastClick -->
<script src="bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- Sparkline -->
<script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
<!-- ChartJS -->
<script src="bower_components/chart.js/Chart.js"></script>
<!-- date-range-picker -->
<script src="bower_components/moment/min/moment.min.js"></script>
<script src="bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<script>


    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyBId7XZ1vDLRaG9VcS8GkElSBEmq3YCCTk",
        authDomain: "bodycams-1aadf.firebaseapp.com",
        databaseURL: "https://bodycams-1aadf.firebaseio.com",
        projectId: "bodycams-1aadf",
        storageBucket: "bodycams-1aadf.appspot.com",
        messagingSenderId: "729988944842"
    };


    firebase.initializeApp(config);
    var db = firebase.firestore();

    const settings = {/* your settings... */ timestampsInSnapshots: true};
    db.settings(settings);

    var docRefPais = db.collection('paises')
    var docRefRegiones = db.collection('regiones')
    var docRefCiudad = db.collection('ciudades')
    var docRefSedes = db.collection('sedes')
    var docRefSalon = db.collection('salones')
    var docRefClase = db.collection('clases')
    var docRefProfesor = db.collection('profesores')

    var paisSelected = ""
    var regionSelected = ""
    var ciudadSelected = ""
    var sedeSelected = ""
    var salonSelected = ""
    var claseSelected = ""
    var profesorSelected = ""

    var startDate;
    var endDate;


    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            // User is signed in.
            console.log(user)

            // ...
        } else {
            // User is signed out.
            console.log("no user")
            window.location.href = "login.html"
            // ...
        }
    });



    function setDateRange()
    {
      $('#datePicker').daterangepicker(
        {
          autoUpdateInput: false,
          maxDate: moment(),
          "locale": {
              "format": "MM/DD/YYYY",
              "separator": " - ",
              "applyLabel": "Aplicar",
              "cancelLabel": "Cancelar",
              "fromLabel": "De",
              "toLabel": "Hasta",
              "customRangeLabel": "Custom",
              "daysOfWeek": [
                  "Do",
                  "Lu",
                  "Ma",
                  "Mi",
                  "Ju",
                  "Vi",
                  "Sa"
              ],
              "monthNames": [
                  "Enero",
                  "Febrero",
                  "Marzo",
                  "Abril",
                  "Mayo",
                  "Junio",
                  "Julio",
                  "Agosto",
                  "Septiembre",
                  "Octubre",
                  "Noviembre",
                  "Diciembre"
              ],
              "firstDay": 1
          }
      },
      function(start, end, label) {
        console.log("Callback has been called!");

        startDate = start;
         endDate = end;

         var diff = start.diff(end, 'days');
         console.log("diff",diff)

         var arrL = []
         var arrData = []
         for(i=0; i<diff*-1;i++)
         {

           arrL.push('')
         }

         docRefClase.get().then(function(querySnapshot) {

             querySnapshot.forEach(function(doc) {

                 var _title = doc.data().nombre
                 var _arr = doc.data().asistencias

                 var arr2 = []
                 for(var i=0; i<_arr.length; i++)
                 {
                     arr2.push(_arr[i].promedio)

                 }

                 var obj = {
                   label               : _title,
                   fillColor           : 'rgb(210, 214, 222)',
                   strokeColor         : 'rgb(210, 214, 222)',
                   data                : arr2
                 }

                 arrData.push(obj)

             });

             arrL[0] = start.format('D MMMM YYYY');
             arrL[arrL.length-1] = end.format('D MMMM YYYY');

             console.log(arrData);
             createChart(arrL, arrData)

         });




       })
    }

    function createChart(_arrLabels, _arrDatasets)
    {
      // -----------------------
      // - CHART -
      // -----------------------

      // Get context with jQuery - using jQuery's .get() method.
      var salesChartCanvas = $('#salesChart').get(0).getContext('2d');
      // This will get the first returned node in the jQuery collection.
      var salesChart       = new Chart(salesChartCanvas);

      var salesChartData = {
        labels  : _arrLabels,
        datasets: _arrDatasets
      };

      var salesChartOptions = {
        // Boolean - If we should show the scale at all
        showScale               : true,
        // Boolean - Whether grid lines are shown across the chart
        scaleShowGridLines      : false,
        // String - Colour of the grid lines
        scaleGridLineColor      : 'rgba(0,0,0,.05)',
        // Number - Width of the grid lines
        scaleGridLineWidth      : 1,
        // Boolean - Whether to show horizontal lines (except X axis)
        scaleShowHorizontalLines: true,
        // Boolean - Whether to show vertical lines (except Y axis)
        scaleShowVerticalLines  : true,
        // Boolean - Whether the line is curved between points
        bezierCurve             : true,
        // Number - Tension of the bezier curve between points
        bezierCurveTension      : 0.3,
        // Boolean - Whether to show a dot for each point
        pointDot                : false,
        // Number - Radius of each point dot in pixels
        pointDotRadius          : 4,
        // Number - Pixel width of point dot stroke
        pointDotStrokeWidth     : 1,
        // Number - amount extra to add to the radius to cater for hit detection outside the drawn point
        pointHitDetectionRadius : 20,
        // Boolean - Whether to show a stroke for datasets
        datasetStroke           : true,
        // Number - Pixel width of dataset stroke
        datasetStrokeWidth      : 2,
        // Boolean - Whether to fill the dataset with a color
        datasetFill             : true,
        // String - A legend template
        legendTemplate          : '<ul class=\'<%=name.toLowerCase()%>-legend\'><% for (var i=0; i<datasets.length; i++){%><li><span style=\'background-color:<%=datasets[i].lineColor%>\'></span><%=datasets[i].label%></li><%}%></ul>',
        // Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
        maintainAspectRatio     : true,
        // Boolean - whether to make the chart responsive to window resizing
        responsive              : true
      };

      // Create the line chart
      salesChart.Bar(salesChartData, salesChartOptions);
    }


    // -----------------------
    // - RDY -
    // -----------------------
    $(document).ready(function()
    {
      stats()
      //createChart()


      //Date range picker
      $('#datePicker').daterangepicker()
      setDateRange()
      $('#datePicker').on('apply.daterangepicker', function(ev, picker) {
        console.log("do something", picker)

      });
      $('#datePicker').on('apply.daterangepicker', function(ev, picker) {
          $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));
      });

      $('#datePicker').on('cancel.daterangepicker', function(ev, picker) {
          $(this).val('');
      });




      $('#item_pais').on('change', function() {
        //load cities
        var _item_link = $( "#item_pais option:selected" ).text()
        paisSelected = _item_link
        regionSelected = ""
        ciudadSelected = ""
        sedeSelected = ""
        salonSelected = ""
        claseSelected = ""



        $("#bodyTable")
        .find('td')
        .remove()
        .end()

        $("#item_region")
        .find('option')
        .remove()
        .end()

        $("#item_ciudad")
        .find('option')
        .remove()
        .end()

        $("#item_sede")
        .find('option')
        .remove()
        .end()

        $("#item_salon")
        .find('option')
        .remove()
        .end()

        $("#item_clase")
        .find('option')
        .remove()
        .end()

        stats()


        docRefRegiones.where("pais", "==", _item_link).get().then(function(querySnapshot) {

            $("#item_region").append('<option value="noSeleccionado">Selecciona</option>')
            querySnapshot.forEach(function(doc) {
                // doc.data() is never undefined for queryClases doc snapshots
                //console.log(doc.id, " => ", doc.data());
                var _title = doc.data().nombre
                var _id = doc.id

                var div = '<option value="'+_id+'">'+_title+'</option>'

                $("#item_region").append(div)
                //console.log("value: ",$("#item_pais").val());

            });

        });
      });

      $('#item_region').on('change', function() {
        //load cities
        var _item_link = $( "#item_region option:selected" ).text()
        regionSelected = _item_link
        ciudadSelected = ""
        sedeSelected = ""
        salonSelected = ""
        claseSelected = ""


        $("#bodyTable")
        .find('td')
        .remove()
        .end()

        $("#item_ciudad")
        .find('option')
        .remove()
        .end()

        $("#item_sede")
        .find('option')
        .remove()
        .end()

        $("#item_salon")
        .find('option')
        .remove()
        .end()

        $("#item_clase")
        .find('option')
        .remove()
        .end()

        stats()
        docRefCiudad.where("region", "==", _item_link).get().then(function(querySnapshot) {
          $("#item_ciudad").append('<option value="noSeleccionado">Selecciona</option>')
            querySnapshot.forEach(function(doc) {
                // doc.data() is never undefined for queryClases doc snapshots
                //console.log(doc.id, " => ", doc.data());

                var _title = doc.data().nombre
                var _id = doc.id

                var div = '<option value="'+_id+'">'+_title+'</option>'

                $("#item_ciudad").append(div)
                //console.log("value: ",$("#item_pais").val());

            });
        });
      });

      $('#item_ciudad').on('change', function() {
        //load cities
        var _item_link = $( "#item_ciudad option:selected" ).text()
        ciudadSelected = _item_link
        sedeSelected = ""
        salonSelected = ""
        claseSelected = ""


        $("#item_sede")
        .find('option')
        .remove()
        .end()

        $("#item_salon")
        .find('option')
        .remove()
        .end()

        $("#item_clase")
        .find('option')
        .remove()
        .end()

        $("#bodyTable")
        .find('option')
        .remove()
        .end()

        stats()

        docRefSedes.where("ciudad", "==", _item_link).get().then(function(querySnapshot) {
          $("#item_sede").append('<option value="noSeleccionado">Selecciona</option>')
            querySnapshot.forEach(function(doc) {
                // doc.data() is never undefined for queryClases doc snapshots
                //console.log(doc.id, " => ", doc.data());

                var _title = doc.data().nombre
                var _id = doc.id

                var div = '<option value="'+_id+'">'+_title+'</option>'

                $("#item_sede").append(div)
                //console.log("value: ",$("#item_pais").val());

            });
        });
      });

      $('#item_sede').on('change', function() {
        //load sedes
        var _item_link = $( "#item_sede option:selected" ).text()

        sedeSelected = _item_link
        salonSelected = ""
        claseSelected = ""


        $("#item_salon")
        .find('option')
        .remove()
        .end()

        $("#item_clase")
        .find('option')
        .remove()
        .end()

        $("#bodyTable")
        .find('option')
        .remove()
        .end()

        stats()

        docRefSalon.where("sede", "==", _item_link).get().then(function(querySnapshot) {
          $("#item_salon").append('<option value="noSeleccionado">Selecciona</option>')
            querySnapshot.forEach(function(doc) {
                // doc.data() is never undefined for queryClases doc snapshots
                //console.log(doc.id, " => ", doc.data());

                var _title = doc.data().nombre
                var _id = doc.id

                var div = '<option value="'+_id+'">'+_title+'</option>'

                $("#item_salon").append(div)
                //console.log("value: ",$("#item_pais").val());

            });
        });
      });

      $('#item_salon').on('change', function() {
        //load cities
        var _item_link = $( "#item_salon option:selected" ).text()

        salonSelected = _item_link
        claseSelected = ""


        $("#item_clase")
        .find('option')
        .remove()
        .end()

        $("#bodyTable")
        .find('option')
        .remove()
        .end()

        stats()

        docRefClase.where("salon", "==", _item_link).get().then(function(querySnapshot) {
          $("#item_clase").append('<option value="noSeleccionado">Selecciona</option>')
            querySnapshot.forEach(function(doc) {
                // doc.data() is never undefined for queryClases doc snapshots
                //console.log(doc.id, " => ", doc.data());

                var _title = doc.data().nombre
                var _timeS = doc.data().h_inicio
                var _timeF = doc.data().h_final

                var _fullTitle = _title + " de (" + _timeS + "-" + _timeF +")"
                var _id = doc.id

                var div = '<option value="'+_id+'">'+_title+'</option>'

                $("#item_clase").append(div)
                //console.log("value: ",$("#item_link").val());

            });
        });
      });

      $('#item_clase').on('change', function() {
        //load cities
        var _item_link = $( "#item_salon option:selected" ).text()


        claseSelected = _item_link
        stats()

      });


      //load info clases
      var numClases
      var numProf
      function stats()
      {
        numClases = 0
        numProf = 0
        $('#clases_creadas').html(numClases)
        $('#num_profesores').html(numProf)

        var queryClases = docRefClase
        var queryProfesor = docRefProfesor

        if(paisSelected!="")
        {
          queryClases = docRefClase.where("pais", "==", paisSelected)
          queryProfesor = docRefProfesor.where("pais", "==", paisSelected)
        }


        if(regionSelected!="")
        {
          queryClases = docRefClase.where("region", "==", regionSelected)
          queryProfesor = docRefProfesor.where("region", "==", regionSelected)
        }

        if(ciudadSelected!="")
        {
          queryClases = docRefClase.where("ciudad", "==", ciudadSelected)
          queryProfesor = docRefProfesor.where("ciudad", "==", ciudadSelected)
        }

        if(sedeSelected!="")
        {
          queryClases = docRefClase.where("sede", "==", sedeSelected)
          queryProfesor = docRefProfesor.where("sede", "==", sedeSelected)
        }


        if(salonSelected!="")
        {
          queryClases = docRefClase.where("salon", "==", salonSelected)
          queryProfesor = docRefProfesor.where("salon", "==", salonSelected)
        }



        queryClases.get().then(function(querySnapshot) {
            querySnapshot.forEach(function(doc) {
              numClases++
              $('#clases_creadas').html(numClases)

              var myId = doc.id
              var _pais = doc.data().pais
              var _region = doc.data().region
              var _ciudad = doc.data().ciudad
              var _sede = doc.data().sede
              var _salon = doc.data().salon
              var _clase = doc.data().nombre
              var _arr = doc.data().asistencias

              var arr2 = []
              for(var i=0; i<_arr.length; i++)
              {
                  arr2.push(_arr[i].promedio)

              }
              console.log("_arr",arr2);

              var div = '<tr>\n' +
                  '                            <td>'+_pais+'</td>\n' +
                  '                            <td>'+_region+'</td>\n' +
                  '                            <td>'+_ciudad+'</td>\n' +
                  '                            <td>'+_sede+'</td>\n' +
                  '                            <td>'+_salon+'</td>\n' +
                  '                            <td>'+_clase+'</td>\n' +
                  '                            <td>' +
                  '                               <div id="sparkbar'+numClases+'">'+arr2+'</div>'+
                  '                             </td>'+
                  '                            </tr>'

              $("#bodyTable").append(div)

              $('#sparkbar'+numClases).sparkline('html', {type: 'bar'})
            });
        });

        queryProfesor.get().then(function(querySnapshot) {
            querySnapshot.forEach(function(doc) {
              numProf++
              $('#num_profesores').html(numProf)
            });
        });
      }


      //load countries
      docRefPais.get().then(function(querySnapshot) {
        $("#item_pais").append('<option value="noSeleccionado">Selecciona</option>')
          querySnapshot.forEach(function(doc) {
              // doc.data() is never undefined for queryClases doc snapshots
              //console.log(doc.id, " => ", doc.data());

              var _title = doc.data().nombre
              var _id = doc.id

              var div = '<option value="'+_id+'">'+_title+'</option>'

              $("#item_pais").append(div)
              //console.log("value: ",$("#item_pais").val());

          });
      });



    })





</script>

<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. -->
</body>
</html>
